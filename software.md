# Software

## Host - OS and hypervisor software

1. CentOS 7 as host OS for the system

    Basically I have a standard installation of CentOS 7; a minimal system with additional reduced Gnome desktop. <br/>
    
    ```yum groupinstall "X Window System"```<br/>
	```yum install gnome-classic-session gnome-terminal nautilus-open-terminal control-center liberation-mono-fonts```<br/>
    
    As the system is a dedicated 24/7 folding box I don't need any additional fancy stuff like games etc. Just a plain and simple OS with X to be able to control the fans.<br/>
    
    Check that the installed system is capable to use virtualizing technology	 
	>```grep -c '(vmx|svm)' /proc/cpuinfo``` 

	The output should show the flags of the CPU capabilities; like in my case
    > processor	: 7<br/>
	> vendor_id	: GenuineIntel<br/>
	> cpu family	: 6<br/>
	> model		: 42<br/>
	> model name	: Intel(R) Core(TM) i7-2600S CPU @ 2.80GHz<br/>
	> ....<br/>
	> fpu		: yes<br/>
	> fpu_exception	: yes<br/>
	> cpuid level	: 13<br/>
	> wp		: yes<br/>
	> flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl **vmx** smx est tm2 ssse3 cx16 xtpr pdcm pcid sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes xsave **avx** lahf_lm epb tpr_shadow vnmi flexpriority ept vpid xsaveopt dtherm ida arat pln pts<br/>

    We are ready to fly ... <br/>
    
	Change in ```/etc/default/grub``` to blacklist nouveau and enable IOMMU (in my case for Intel-CPU; a different option for AMD required)
> GRUB_CMDLINE_LINUX="vconsole.keymap=jp106 crashkernel=auto  vconsole.font=latarcyrheb-sun16 rhgb **rd.driver.pre=vfio-pci**  **rdblacklist=nouveau** text **intel_iommu=on**"

	`grub2-mkconfig --output=/boot/grub2/grub.cfg` to update GRUB

	Make sure to blacklist (e.g. via file `/etc/blacklist.conf`) some driver conflicting with nVidia
    > `#` generated by nvidia-installer<br/>
	> blacklist nouveau<br/>
	> options nouveau modeset=0<br/>



	Add a file like this (e.g. `local.conf`) in in folder `/etc/modprobe.d`
> options vfio-pci ids=10de:13c2,10de:0fbb


2. Linux Kernel vanilla 4.5.2, self-compiled to make 
checking if important parameter `CONFIG_VFIO_PCI` is set
> grep CONFIG_VFIO_PCI /boot/config-`uname -r`

Grouping of PCI devices
> find /sys/kernel/iommu_groups/ -type l


3. nV driver 361.28

Had to enter the path of used linux kernel source code
> sh ./NVIDIA-Linux-x86_64-361.28.run --kernel-source-path=/usr/src/linux-4.5.2/

4. QEMU 2.5.1 
Basically following the instruction from here: ...

> QEMU_ARCH=x86_64-softmmu
>  ./configure --prefix=/usr --sysconfdir=/etc --target-list=$QEMU_ARCH  --docdir=/usr/share/doc/qemu-2.5.1
> make
> sudo make install
> qemu-system-x86_64 --version

5. a number of dependencies solved via yum




## OS - Guest

1. Windows 8.1 Pro 64 Bit as OS for the guest

Standard installation of Windows basically; you need your own product key for activation.

Tricky part was was the basic installation to turn off the standard VGA emulation and force Windows to use the GPU card for output. This eventually avoided trouble during startup


2. nV-CUDA driver 7.5


  108  lspci
  109  grep -v '(vmx|svm)' /proc/cpuinfo 
  111  more /proc/cpuinfo 
  112   sudo yum install kvm virt-manager libvirt virt-install qemu-kvm xauth dejavu-lgc-sans-fonts
  113  echo "net.ipv4.ip_forward = 1" | sudo tee /etc/sysctl.d/99-ipforward.conf
  114  sudo sysctl -p /etc/sysctl.d/99-ipforward.conf 

 278  lspci -nn | grep VGA
 
   292  dmesg | grep DMAR
  293  dmesg | grep IOMMU




